{% extends 'layout.jinja2' %}

{% block content %}

<!-- Javascript for websocket functions -->
<script>
    // Listens to "new incoming" message and updates incoming value.
    socket.on('new incoming', function(data){
    console.log("incoming message:", data.toString())
    document.getElementById("incoming").innerHTML = data.toString();
    });                 

    function send_motor_speed(){
        var slider = document.getElementById("motorSpeed");
        // var motor_speed = {speed : slider.value};
        console.log('Sending motor speed!');
        socket.emit('new motor speed', slider.value);
    }

    function toggle_motor(){
        var elem = document.getElementById("motorStatus");
        if (elem.value=="Enable Motor"){
            socket.emit('enable motor');
            elem.value = "Disable Motor";
        }
        else{
            socket.emit('disable motor');
            elem.value = "Enable Motor";

        } 
        $("#outgoing").load(location.href + " #outgoing");
    }   
</script>


<div id="motorControl">
    <h1>Motor Control</h1>
    <!-- Motor on/off toggle -->
    <input onclick="toggle_motor()" type="button" value="Enable Motor" id="motorStatus"></input>

    <!-- Create slider -->
    <div class="slidecontainer">
        <!-- <input type="range" min="-1" max="1" value="0" step="0.1" class="slider" id="motorSpeed" onmouseup="send_motor_command()" ontouchend="send_motor_command()"> -->
        <input type="range" min="-1" max="1" value="0" step="0.1" class="slider" id="motorSpeed" onchange="send_motor_speed()">
        <p>Value: <span id="display"></span></p>
    </div>

    <script>
        var slider = document.getElementById("motorSpeed");
        var output = document.getElementById("display");
        output.innerHTML = slider.value;

        // Displays the current slider value hw
        slider.oninput = function() {
            output.innerHTML = this.value;
        }
    </script>
</div>

<button onclick="window.location.href='/';">
    Refresh
</button>

<div>
    <h2>Serial Send</h2>
    <form method="POST" action="/">
        {{ form.csrf_token }}
        <div>{{ form.json.label }} {{ form.json(size=20) }}</div>
        {{ form.submit }}
    </form>
</div>

<div id="outgoing">
    <h2>Outgoing</h2>
    {{ outgoing }}
</div>

<div>
    <h2>Incoming</h2>
    <!-- {{ incoming }} -->
    <div  id="incoming"> </div>

</div>



{% endblock %}

